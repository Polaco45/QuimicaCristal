<odoo>
  <data>

    <!-- Template corregida: fija siempre el From como Crilim S.A.S.
         y construye correctamente el link de registro -->
    <record id="join_affiliate_email" model="mail.template">
      <field name="name">Affiliate Request Connection</field>
      <field name="model_id" ref="affiliate_management.model_affiliate_request"/>

      <!-- Forzamos remitente visible -->
      <field name="email_from">Crilim S.A.S. &lt;notifications@polaco45-cristalprueba.odoo.com&gt;</field>

      <!-- Destinatario: usa el email del partner o, en su defecto, el nombre -->
      <field name="email_to">{{ object.partner_id.email_formatted or object.name or '' }}</field>

      <field name="subject">Invitation to connect on Affiliate Program</field>

      <field name="body_html" type="html">
        <div style="padding:0px;width:600px;margin:auto;background:#FFFFFF repeat top /100%;color:#777777;">
          <p>
            Dear
            <t t-out="object.partner_id.name or object.name or ''">Marc Demo</t>,
          </p>
          <p>
            You have been invited to connect to Affiliate Program in order to get access to your Account.
            Please complete your sign up process.
          </p>
          <p>To accept the invitation, click on the following link:</p>

          <!-- ConstrucciÃ³n del href sin ancla inicial y sin mezclar sintaxis -->
          <div style="text-align: center; margin-top: 16px;">
            <a t-att-href="'%s/affiliate/signup?db=%s&token=%s' % (object.website_id.domain, object.env.cr.dbname, (object.signup_token or 'testtoken'))"
               style="padding: 5px 10px; font-size: 12px; line-height: 18px; color: #FFFFFF; border-color:#875A7B; text-decoration: none; display: inline-block; margin-bottom: 0px; font-weight: 400; text-align: center; vertical-align: middle; cursor: pointer; white-space: nowrap; background-image: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius:3px">
              Accept invitation to Affiliate Program
            </a>
          </div>

          <br/>Best regards,<br/>
          <t t-if="user.signature">
            <br/>
            <t t-out="user.signature or ''">--<br/>Mitchell Admin</t>
          </t>
        </div>
      </field>
    </record>

  </data>
</odoo>
